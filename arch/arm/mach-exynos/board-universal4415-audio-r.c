/*
 * Copyright (c) 2012 Samsung Electronics Co., Ltd.
 *		http://www.samsung.com
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
*/

#include <linux/gpio.h>
#include <linux/i2c.h>
#include <linux/io.h>
#include <linux/exynos_audio.h>
#include <linux/regulator/machine.h>
#include <linux/regulator/fixed.h>

#include <linux/mfd/rt5511/pdata.h>
#include <linux/mfd/rt5511/registers.h>

#include <plat/gpio-cfg.h>
#include <plat/devs.h>
#include <plat/iic.h>

#include <mach/map.h>
#include <mach/exynos4-audio.h>

#include "board-universal4415.h"


/* RT5511 EQ, DRC, DRC-NG Coeff & Enable Table */

static bool rt5511_eq_en[RT5511_BQ_PATH_NUM] = {
	false, false
}; /* RT5511_EQEn */

static struct rt5511_eq_cfg rt5511_eq_cfgs[RT5511_BQ_SET_NUM] = {
{ /* EQCoeff Set0 */
	.en = { false, false, false, false, false,
		false, false, false, false, false },
	.coeff[0] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[1] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[2] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[3] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[4] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[5] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[6] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[7] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[8] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[9] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
},
{ /* EQCoeff Set1 */
	.en = { false, false, false, false, false,
		false, false, false, false, false },
	.coeff[0] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[1] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[2] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[3] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[4] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[5] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[6] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[7] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[8] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[9] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
},
{ /* EQCoeff Set2 */
	.en = { false, false, false, false, false,
		false, false, false, false, false },
	.coeff[0] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[1] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[2] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[3] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[4] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[5] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[6] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[7] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[8] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[9] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
},
{ /* EQCoeff Set3 */
	.en = { false, false, false, false, false,
		false, false, false, false, false },
	.coeff[0] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[1] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[2] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[3] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[4] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[5] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[6] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[7] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[8] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	.coeff[9] = {
		0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
},
}; /* rt5511_eq_cfgs */

static bool rt5511_drc_en[RT5511_DRC_REG_NUM] = {
	false, false, false, false, false, false
}; /* rt5511_drc_en */

static struct rt5511_drc_cfg rt5511_drc_cfgs[RT5511_DRC_REG_NUM] = {
{ /* DRC[0] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
{ /* DRC[1] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
{ /* DRC[2] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
{ /* DRC[3] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
{ /* DRC[4] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
{ /* DRC[5] */
	.coeff1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10 },
	.coeff2 = { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		    0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00 },
},
}; /* rt5511_drc_cfgs */

#define RT5511_DRC_NG_EN (0x00)

static u8 rt5511_drc_ng_cfg[RT5511_DRC_NG_REG_SIZE] = {
	0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff
}; /* rt5511_drc_ng_cfg */

static u8 rt5511A_dre_cfg[RT5511A_DRE_REG_SIZE] = {
	0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 0x10,
}; /* rt5511A_dre_cfg */

static struct rt5511_pdata rt5511_pdata = {
	.micbias = { 3, 3 },
	.mic1_differential = 0,
	.mic2_differential = 0,
	.mic3_differential = 1,

	.eq_en = rt5511_eq_en,
	.eq_cfgs = rt5511_eq_cfgs,

	.drc_en = rt5511_drc_en,
	.drc_cfgs = rt5511_drc_cfgs,

	.drc_ng_en = RT5511_DRC_NG_EN,
	.drc_ng_cfg = rt5511_drc_ng_cfg,

	.dre_cfg = rt5511A_dre_cfg,
};

static struct i2c_board_info __initdata i2c_devs1[] = {
	{
		I2C_BOARD_INFO("rt5511", (0x18)),
		.platform_data = &rt5511_pdata,
	},
};

struct exynos_sound_platform_data universal4415_sound_pdata __initdata = {
	.set_mclk = exynos4_audio_set_mclk,
};

static struct platform_device rt5511_snd_card_device = {
	.name   = "rt5511-card",
	.id     = -1,
};

static struct platform_device *universal4415_audio_devices[] __initdata = {
	&s3c_device_i2c1,
	&rt5511_snd_card_device,
};

void __init exynos4_universal4415_audio_init(void)
{
	exynos4_audio_init();

	s3c_i2c1_set_platdata(NULL);
	i2c_register_board_info(1, i2c_devs1, ARRAY_SIZE(i2c_devs1));

	platform_add_devices(universal4415_audio_devices,
			     ARRAY_SIZE(universal4415_audio_devices));

	if (exynos_sound_set_platform_data(&universal4415_sound_pdata))
		pr_err("%s: failed to register sound pdata\n", __func__);
}
